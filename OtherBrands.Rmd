---
title: "R Notebook"
output: html_notebook
---
Read in original data and new brand data
Then combine into single dataframe "diamonds" (matching TJ's naming)
Which now has a new column "vendor"
Original data file has value "vendor" == "Original"

```{r}
orig_diamonds= read.csv("diamonds4.csv")
orig_diamonds = data.frame(orig_diamonds)
orig_diamonds$vendor = "Original"

extra_diamonds= read.csv("extra_diamonds.csv")
extra_diamonds = data.frame(extra_diamonds)
keep_columns = c("carat","clarity","color","cut","price","vendor")
extra_diamonds = extra_diamonds[keep_columns]

diamonds <- rbind(extra_diamonds, orig_diamonds)

```

Simplify categories using TJ's code 

```{r}
library(MASS) 
library(dplyr)
#EDA for project

diamonds$clarity = factor(diamonds$clarity)
diamonds$cut= factor(diamonds$cut)
diamonds$color =factor(diamonds$color)

#levels(diamonds$clarity)
#levels(diamonds$cut)
#levels(diamonds$color)

#adjusting the data frame variables to the transformed versions
diamonds$price = log(diamonds$price)
diamonds$carat = log(diamonds$carat + .2)

###############################################
#### NOTE: I added "K" to colorgroup3
###############################################
##### setting new levels and reference levels
levels(diamonds$color) <- list("colorgroup1" = c("D"),
                      "colorgroup2"   = c("E","F","G","H"),
                      "colorgroup3"   = c("I","J","K"))

diamonds$color = relevel(diamonds$color, ref = "colorgroup3")
contrasts(diamonds$color)

###############################################
#### NOTE: I added "Excellent" to cutgroup2
###############################################
levels(diamonds$cut) <- list("cutgroup1" = c("Astor Ideal"),
                             "cutgroup2"   = c("Ideal", "Excellent"),
                             "cutgroup3"   = c("Good","Very Good"))

diamonds$cut = relevel(diamonds$cut, ref = "cutgroup3")
contrasts(diamonds$cut)

levels(diamonds$clarity) <- list("claritygroup1" = c("FL","IF"),
                                 "claritygroup2"   = c("VS1","VVS1","VS2","VVS2"),
                                 "claritygroup3"   = c("SI1","SI2"))

diamonds$clarity = relevel(diamonds$clarity, ref = "claritygroup3")
contrasts(diamonds$clarity)

```

Set aside the external vendors' diamonds into dataframe "subExtra"
Then remove them from our main "diamonds" dataframe
They will not influence our model and can be used for testing

After this code snippet, "diamonds" will contain the same data as the original
(except it has the new column "vendor")

```{r}
subCostco<-subset(diamonds,vendor=="Costco")
subBlueNile<-subset(diamonds,vendor=="BlueNile")
subDanielWilliams<-subset(diamonds,vendor=="DanielWilliams")
diamonds<-subset(diamonds,vendor=="Original")
```

See how Vendors' diamond data compares to original
Temporarily remove diamonds over 4.5 carats to better focus on
the Vendors' diamonds 

```{r}
diamonds_focused<-subset(diamonds,carat<4.5)
plot(diamonds_focused$carat,diamonds_focused$price, main="Price against carat",
     ylab="Price in dollars (year unknown)",
     xlab="Carats")
points(subCostco$carat,subCostco$price, pch=2, col="red")
points(subBlueNile$carat,subBlueNile$price, pch=12, col="blue")
points(subDanielWilliams$carat,subDanielWilliams$price, pch=8, col="green")

legend("topleft", c("Original Data","Costco","Blue Nile","Daniel Williams"), lty=c(1,2,3,4),
       pch=c(1,2,12,8), col=c("black","red","blue","green"))
```

Create model (without any interactions)

```{r}
#model with all additive terms and condensed #classes
test_lm = lm(price~carat+cut+clarity+color, data=diamonds)
summary(test_lm)

```

An initial test of predictions


```{r}

predict(test_lm, newdata = subCostco, interval = "prediction")
```

